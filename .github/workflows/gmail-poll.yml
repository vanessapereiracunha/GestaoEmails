name: Gmail Poll
on:
  schedule:
    - cron: '*/2 * * * *'  # a cada 2 minutos
  workflow_dispatch:       # permite rodar manualmente
jobs:
  poll:
    runs-on: ubuntu-latest
    steps:
      - name: Call Gmail Poll Function
        run: |
          curl -X POST '${{ secrets.SUPABASE_URL }}/functions/v1/gmail-poll' \
            -H 'Authorization: Bearer ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}' \
            -H 'Content-Type: application/json' \
            -d '{}'
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}